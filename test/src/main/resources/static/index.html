<!doctype html>
<html>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width initial-scale=1'>
    <title>README</title></head>
<body><p>#### </p>
<h4>info</h4>
<pre><code class='language-json' lang='json'>GET /redisWebAdmin/info
GET /redisWebAdmin/dbInfo
</code></pre>
<hr/>
<h4>keys</h4>
<pre><code class='language-javascript' lang='javascript'># description： key搜索，支持模糊搜索和精确匹配
#request
GET /redisWebAdmin/keys?key=test&amp;exact=false
[key]: #key 关键字
[exact]:  #是否精确匹配（true、false），默认false

#response keys list
[
  &quot;test/dev/key&quot;,
  &quot;test/dev/key2&quot;,
  &quot;test/dev/key3&quot;
]
</code></pre>
<hr/>
<h4>get key</h4>
<pre><code class='language-javascript' lang='javascript'># description： 获取key的值
#request
GET /redisWebAdmin/getKey?key=demo-string-key

#response
{
  &quot;size&quot;: 380, # 值的所占用的字节大小，如果是集合，则是元素的个数
  &quot;type&quot;: &quot;string&quot;, #值的数据类型（string、list、set、zset、hash）
  &quot;value&quot;: &quot;value&quot;, # 依据 type 呈现不同的形式 （&quot;string&quot;，[list],[set],[{zset}],{map}）
  &quot;ttl&quot;: -1 # ttl
}
</code></pre>
<hr/>
<h4>add or update key</h4>
<p>&nbsp;</p>
<pre><code class='language-javascript' lang='javascript'># description： 新增或更新key
#request
POST /redisWebAdmin/addOrUpdate
content-type : application-json/charset=utf8

【type=string】
{
  &quot;key&quot;: &quot;141232133113211&quot;,
  &quot;type&quot;: &quot;string&quot;,
   // 新值
  &quot;newValue&quot;: &quot;newValue_eikio&quot;
}

【type=list】单个更新
{
  &quot;key&quot;: &quot;demo-list-key&quot;,
  &quot;type&quot;: &quot;list&quot;,
   // 新值
  &quot;newValue&quot;: &quot;newValue_eikio&quot;,
   // 元素的index
  &quot;index&quot;: 2
}
【type=list】全量更新
{
  &quot;key&quot;: &quot;demo-list-key&quot;,
  &quot;type&quot;: &quot;list&quot;,
   // list
  &quot;listValue&quot;: [
    &quot;listValue_vdjxa&quot;,
    &quot;listValue_vdjxa2&quot;,
    &quot;listValue_vdjxa3&quot;
  ],
   // 全量更新标识
  &quot;updateAll&quot;: true
}
【type=set】单个更新
{
    &quot;key&quot;: &quot;demo-set-key&quot;,
    &quot;type&quot;: &quot;set&quot;,
    // 新值
    &quot;newValue&quot;: &quot;newValue_isfnk&quot;,
    // 旧值
    &quot;oldValue&quot;: &quot;111&quot;
}
【type=set】全量更新
{
    &quot;key&quot;: &quot;demo-set-key&quot;,
    &quot;type&quot;: &quot;set&quot;,
    &quot;listValue&quot;: [
        &quot;listValue_bjsxk&quot;,
        &quot;listValue_bjsxk2&quot;,
        &quot;listValue_bjsxk3&quot;,
        &quot;listValue_bjsxk4&quot;
    ],
    &quot;updateAll&quot;: true
}

【type=zset】单个更新
{
  &quot;key&quot;: &quot;demo-zset-key&quot;,
  &quot;type&quot;: &quot;zset&quot;,
    // 旧值
  &quot;oldValue&quot;: &quot;value_lvloq2&quot;,
    // 新值
  &quot;newZset&quot;: {
    &quot;score&quot;: 1111.0,
    &quot;value&quot;: &quot;value_t1d4l222&quot;
  }
}

【type=zset】全量更新
{
  &quot;key&quot;: &quot;demo-zset-key&quot;,
  &quot;type&quot;: &quot;zset&quot;,
   // zset 集合
  &quot;zsets&quot;: [
    {
      &quot;score&quot;: 1.0,
      &quot;value&quot;: &quot;value_lvloq&quot;
    },
    {
      &quot;score&quot;: 2.0,
      &quot;value&quot;: &quot;value_lvloq2&quot;
    }
  ],
  &quot;updateAll&quot;: true
}

【type=hash】单个更新
{
  &quot;key&quot;: &quot;demo-hash-key&quot;,
  &quot;type&quot;: &quot;hash&quot;,
   // 旧hash key
  &quot;oldValue&quot;: &quot;old2&quot;,
   // 新hash key
  &quot;newValue&quot;: &quot;old1&quot;,
   // 新hash 值
  &quot;hashValue&quot;: &quot;value_t1d4啥地方撒放l222&quot;
}

【type=hash】全量更新
{
  &quot;key&quot;: &quot;demo-hash-key&quot;,
  &quot;type&quot;: &quot;hash&quot;,
    // 新map
  &quot;mapValue&quot;: {
    &quot;key1&quot;: 1111.0,
    &quot;key2&quot;: &quot;value_t1d4l222&quot;
  },
  &quot;updateAll&quot;: true
}


#response
OK
</code></pre>
<p><img src="../README.assets/18479.png" referrerpolicy="no-referrer" alt="image-20211019135507419"></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
</body>
<script>

    /* Create by ruanmingcong on   */

    /**
     * 获取当前浏览器的语言，区域
     * <br/>并且设置到 localStorage中 lang
     * @returns {string} eg：zh-CN
     */
    function getCurrentLanguage() {
        let type = navigator.appName, lang;
        if (type === "Netscape") {
            lang = navigator.language;
        } else {
            lang = navigator.userLanguage;
        }
        window.localStorage.setItem("lang", lang);
        return lang;
    }

    const colorArray = ['#141614', '#E8BF6A', '#1677DD', '#E81B0E', '#075bba', '#E88D2F', '#5BE817', '#C370E8',];

    /**
     * 通过字符串hash获取颜色
     * @param str
     * @returns {string} 颜色eg：#1677DD
     */
    function getColorByStringHash(str) {
        let index;
        index = (Math.abs(stringHashCode(str))) % (colorArray.length);
        return colorArray[index];
    }


    /**
     * 计算字符串hash
     * @param str
     * @returns {number}
     */
    function stringHashCode(str) {
        let hash = 0;
        if (str != null && str.length > 0) {
            for (let i = 0; i < str.length; i++) {
                let char = str.charCodeAt(i);
                hash = 31 * hash + char;
                hash = hash & hash;
            }
        }
        return hash;
    }

    /**
     * 字符串加密，
     * @param str 源字符串
     * @param count 加密次数 默认1次
     * @returns {*} 密文
     */
    function stringEncrypted(str, count) {
        let r = str;
        count = count || 1;
        for (let i = 0; i < count; i++) {
            r = window.btoa(r);
        }
        return r;
    }


    /**
     * 分组
     * @param arr 源数组
     * @param condition 分组key条件
     */
    function groupBy(arr, condition) {
        let res = {};
        if (arr != null) {
            for (let i = 0; i < arr.length; i++) {
                let key = condition(arr[i]);
                if (res[key] == null) {
                    res[key] = [];
                }
                res[key].push(arr[i]);
            }
        }
        return res;
    }


    /**
     * 获取请求url中的指定名称参数
     * @param name
     * @returns {*}
     */
    function getQueryString(name) {
        let reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        let r = window.location.search.substr(1).match(reg);
        if (r != null) return decodeURI(r[2]);
        return null;
    }


    /**
     *  http post method
     * @param url
     * @param param js 对象
     * @param done 响应完成后的callback
     */
    function httpPost(url, param, done) {
        httpRequest('post', url, param, true, done);
    }

    /**
     *  http post method
     * @param url
     * @param param js 对象
     * @param done 响应完成后的callback
     */
    function httpGet(url, param, done) {
        httpRequest('get', url, param, true, done);
    }


    /**
     *  http get method sync
     * @param url
     * @param param js 对象
     * @param done 响应完成后的callback
     */
    function httpGetSync(url, param, done) {
        httpRequest('get', url, param, false, done);
    }


    /**
     * http 请求
     * @param method 请求方法get post
     * @param url  请求url
     * @param param 请求参数对象 object
     * @param done  回调函数
     */
    function httpRequest(method, url, param, async, done) {
        let xhr = new XMLHttpRequest();
        if (method === 'get' && param != null) {
            let s = object2QueryString(param);
            if (s.length > 0) {
                url = url + "?" + object2QueryString(param);
            }
        }
        if (url)
            xhr.open(method, url, async);
        if (method === 'post') {
            xhr.setRequestHeader("Content-type", "application/json;charset=utf-8");
        }
        xhr.setRequestHeader("token", window.localStorage.getItem("token"));
        xhr.withCredentials = true;
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                let res = JSON.parse(xhr.responseText);
                if (interceptor(res)) {
                    done(res);
                }
            }
        };
        if (method === 'post') {
            xhr.send(JSON.stringify(param));
        } else {
            xhr.send();
        }
    }


    /**
     * 拦截器
     * @param res
     * @returns {boolean} true 通过，false拦截
     */
    function interceptor(res) {
//    do something
//     console.log("进入拦截器---------")
        if (res.code === 7) {
            window.location.href = "/";
            return false;
        }
        return true;
    }


    /**
     * 将 js 对象转换为 query string
     * @param obj
     * @returns {string}  key=value&k2=v2
     */
    function object2QueryString(obj) {
        let queryStr = "";
        for (let f in obj) {
            queryStr += f + "=" + obj[f] + "&";
        }
        return queryStr.slice(0, queryStr.length - 1);
    }

    /**
     * xor 简单加密
     * @param text
     * @returns {string}
     */
    function xor(text) {
        if (!text) return "";
        let n = "";
        for (let i = 0; i < text.length; i++)
            n += String.fromCharCode(text[i].charCodeAt() ^ 17);
        return n;
    }


    //常用正则

    function isPhone(phone) {
        return /^1\d{10}$/.test(phone);
    }

    function isEmail(email) {
        return /^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(email);
    }


    /*
    *
    * 数据结构
    *
    * */


    function Map() {
        let self = this;
        let m = {};
        // 添加
        self.put = function (key, value) {
            m[key] = value;
        };

        //获取
        self.get = function (key) {
            return m[key];
        };

        //删除
        self.remove = function (key) {
            if (m[key]) {
                delete m[key];
            }
        };

        // 是否存在
        self.has = function (key) {
            for (let k in m) {
                if (k === key) {
                    return true;
                }
            }
            return false;
        };

        //返回size
        self.size = function () {
            let size = 0;
            for (let key in m) {
                size++
            }
            return size;
        };

        // 获取所有key
        self.keys = function () {
            let arr = [];
            for (let key in m) {
                arr.push(key)
            }
            return arr;
        };

        //获取所有 value
        self.values = function () {
            let arr = [];
            for (let key in m) {
                arr.push(m[key])
            }
            return arr;
        };

        //遍历
        self.forEach = function (call) {
            for (let key in m) {
                call(key, m[key])
            }
        };

        self.toJson = function () {
            return JSON.stringify(m);
        }
    }


    /**
     * 格式化时间戳
     * @param time 毫秒值
     */
    function timeFormat(time) {
        let date = new Date(time);
        let y = date.getFullYear();
        let m = date.getMonth() + 1;
        let d = date.getDate();
        let h = date.getHours();
        let mm = date.getMinutes();
        let s = date.getSeconds();
        return y + "-" + padding(m) + "-" + padding(d) + " " + padding(h) + ":" + padding(mm) + ":" + padding(s);
    }

    function padding(i) {
        return i < 10 ? '0' + i : i;
    }
</script>

<script>
    (function () {
        httpGet("http://10.204.227.62:8943/test/all", null, function (res) {
            console.log(res)
        });
        httpGet("http://10.204.227.62:28081/wko/v3/api-docs", null, function (res) {
            console.log(res)
        });

        httpPost("http://10.204.227.62:28081/wko/account/login", {
            empCode: "001122",
            credential: "123"
        }, function (res) {
            console.log(res)
            let token = res.data;
            window.localStorage.setItem("token", token);
            console.log(window.localStorage.getItem("token"));

            httpGet("http://10.204.227.62:28081/wko/account/userInfo", null, function (res) {
                console.log(res)
            })
        });


    }())
</script>
</html>